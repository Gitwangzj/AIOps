import math
import numpy as np
from scipy.linalg.misc import norm


y_observed = [17820652, 18050364, 17911606, 16831316, 8759626, 8546053, 17573559, 17957414, 8579513, 8947416, 8896293, 8513787, 9689336, 7644881, 8187614, 8157440, 14690066, 13122113, 8189606, 8128143, 9928045, 12186196, 11087630, 8487980, 11550187, 15780109, 14416526, 12554730, 9677747, 11517624, 18042087, 17725251, 16918745, 13981266, 9067449, 7621155, 8233936, 6407346, 5129027, 5072525, 5379080, 2749548, 3386364, 2606616, 5753418, 11276798, 6900994, 3827738, 6735140, 10346079, 10970506, 9039637, 6130244, 7863363, 17851643, 16621718, 15299360, 6380432, 5777692, 5496734, 5051249, 4673845, 3902700, 2850843, 5616231, 2150059, 1836288, 2328483, 4835081, 7806310, 6582895, 3822465, 7020531, 9781196, 10954961, 5855414, 6374146, 7007517, 17624561, 11252861, 15389236, 7100923, 6288682, 5557393, 5507696, 4839543, 3215167, 2107288, 5284018, 1677593, 1975131, 2127995, 4371311, 7579893, 6320845, 3379414, 6971598, 10663938, 11656811, 9904060, 6615442, 7785164, 17951288, 18241499, 17124873, 7860011, 5068894, 6072006, 7082042, 5178642, 3504864, 3124104, 5363476, 2672646, 3056433, 2628075, 5603036, 8108877, 7231927, 4471953, 7084985, 12227811, 13953487, 9176698, 7023547, 13697545, 18330191, 18341313, 18270395, 9819666, 6596462, 7404952, 7209089, 4442841, 2527758, 3934994, 7647949, 3578724, 2257577, 3076758, 5145234, 8768478, 7397283, 4147334, 5192010, 5990813, 6407392, 5855151, 6151765, 5421948, 17275831, 13503030, 9697451, 7223771, 6569367, 4713950, 6340608, 3813842, 3705733, 3428458, 6596959, 2956116, 1902686, 2577152, 5127546, 7551840, 7490062, 4156895]
y_train = [17820652.0, 18050364.0, 17911606.0, 16831316.0, 8759626.0, 8546053.0, 17573560.0, 17957414.0, 8579513.0, 8947416.0, 8896293.0, 8513787.0, 9689336.0, 7644881.0, 8187614.0, 8157440.0, 14690066.0, 13122113.0, 8189606.0, 8128143.0, 9928045.0, 12186196.0, 11087630.0, 8487980.0, 11550187.0, 15780109.0, 14416526.0, 12554730.0, 9677747.0, 11517624.0, 18042088.0, 17725252.0, 16918744.0, 13981266.0, 9067449.0, 7621155.0, 8233936.0, 6407346.0, 5129027.0, 5072525.0, 5379080.0, 2749548.0, 3386364.0, 2606616.0, 5753418.0, 11276798.0, 6900994.0, 3827738.0, 6735140.0, 10346079.0, 10970506.0, 9039637.0, 6130244.0, 7863363.0, 17851644.0, 16621718.0, 15299360.0, 6380432.0, 5777692.0, 5496734.0, 5051249.0, 4673845.0, 3902700.0, 2850843.0, 5616231.0, 2150059.0, 1836288.0, 2328483.0, 4835081.0, 7806310.0, 6582895.0, 3822465.0, 7020531.0, 9781196.0, 10954961.0, 5855414.0, 6374146.0, 7007517.0, 17624560.0, 11252861.0, 15389236.0, 7100923.0, 6288682.0, 5557393.0, 5507696.0, 4839543.0, 3215167.0, 2107288.0, 5284018.0, 1677593.0, 1975131.0, 2127995.0, 4371311.0, 7579893.0, 6320845.0, 3379414.0, 6971598.0, 10663938.0, 11656811.0, 9904060.0, 6615442.0, 7785164.0, 17951288.0, 18241500.0, 17124872.0, 7860011.0, 5068894.0, 6072006.0, 7082042.0, 5178642.0, 3504864.0, 3124104.0, 5363476.0, 2672646.0, 3056433.0, 2628075.0, 5603036.0, 8108877.0, 7231927.0, 4471953.0, 7084985.0, 12227811.0, 13953487.0, 9176698.0, 7023547.0, 13697545.0, 18330192.0, 18341312.0, 18270396.0, 9819666.0, 6596462.0, 7404952.0, 7209089.0, 4442841.0, 2527758.0, 3934994.0, 7647949.0, 3578724.0, 2257577.0, 3076758.0, 5145234.0, 8768478.0, 7397283.0, 4147334.0]
y_test = y_observed[-24:]

y_pred = [6684723.5, 11938913.0, 13443566.0, 8347225.0, 6915210.0, 12920393.0, 17551080.0, 18539006.0, 19334632.0, 11434717.0, 7248306.0, 7648686.0, 8441481.0, 6274063.0, 3682197.5, 1838299.0, 6435424.0, 4820655.5, 3791737.2, 1974326.0, 4126265.2, 8414858.0, 8299010.5, 4428706.0]


def get_average_relative_error(y_t, y_p):
    y_relative_error = [math.fabs(y_p[i] - y_t[i]) / y_t[i] for i in range(len(y_p))]
    y_average_relative_error = sum(y_relative_error) / len(y_relative_error)
    return y_average_relative_error


def get_average_absolute_error(y_t, y_p):
    y_absolute_error = [math.fabs(y_p[i] - y_t[i]) for i in range(len(y_p))]
    y_average_absolute_error = sum(y_absolute_error) / len(y_absolute_error)
    return y_average_absolute_error


def cos_similarity(y_t, y_p):
    y_pred_norm = norm(y_t)
    y_test_norm = norm(y_p)
    y_p = np.array(y_p)
    y_t = np.array(y_t)
    y_dot = np.dot(y_p, y_t)
    similarity = y_dot / (y_pred_norm * y_test_norm)
    return similarity


y_test_old = [4156895, 5501395, 5879002, 6243043, 5844507, 5321586, 5320688, 12105759, 13373148,
              5316750, 4785006, 4866517, 4168652, 4577547, 3377613, 8058978, 18567628, 17406465,
              10251277, 2375305, 2143310, 5214524, 7277075, 6727410]
y_pred_old = [3945394, 4773510, 6724705, 8682873, 5799767, 4100952, 4178555, 7646847, 7460724,
              5606597, 2949562, 5116031, 7030748, 7524504, 4023617, 3365801, 4702254, 7679795,
              6082523, 3887776, 2565094, 5663283, 6825446, 5899897]


if __name__ == '__main__':
    print('average_relative_error: ', get_average_relative_error(y_test, y_pred))
    print('average_absolute_error: ', get_average_absolute_error(y_test, y_pred))
    print('similarity: ', cos_similarity(y_test, y_pred))
    print('old model similarity: ', cos_similarity(y_test_old, y_pred_old))
